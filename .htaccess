RewriteEngine On

# Allow direct access to existing files and directories
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^.*$ - [L]

# Handle specific routes that need to go through index.php
RewriteRule ^login/?$ /index.php [QSA,L]
RewriteRule ^register/?$ /index.php [QSA,L]
RewriteRule ^dashboard/?$ /index.php [QSA,L]
RewriteRule ^api/(.*)$ /index.php [QSA,L]

# Only route non-existent files through index.php (for 404 handling)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/(test_db_connection|quick_db_test|fix_database)\.php$
RewriteRule ^.*$ /index.php [QSA,L]